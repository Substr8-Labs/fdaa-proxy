version: "3.8"

# FDAA Verification UI Stack
# Deploys alongside Jaeger for full observability

services:
  verify:
    image: fdaa-proxy:latest
    command: ["fdaa-proxy", "verify", "serve", "--host", "0.0.0.0", "--port", "8080", "--jaeger-url", "http://jaeger:16686", "--dct-path", "/data"]
    environment:
      - JAEGER_URL=http://jaeger:16686
      - DCT_STORAGE_PATH=/data
    ports:
      - "8080:8080"   # Verification UI
    volumes:
      - towerhq_fdaa-data:/data
    networks:
      - towerhq-gateways
    healthcheck:
      test: ["CMD", "python", "-c", "import socket; s=socket.socket(); s.connect(('localhost',8080)); s.close()"]
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 10s
    deploy:
      replicas: 1
      placement:
        constraints:
          - node.role == manager

volumes:
  towerhq_fdaa-data:
    external: true

networks:
  towerhq-gateways:
    external: true
